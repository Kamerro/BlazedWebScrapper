@page "/ksiegarnia"
@using BlazedWebScrapper.Data;
@using HtmlAgilityPack;
@using BlazedWebScrapper.Pages.Components;
@using System.Drawing;
@using System.Text;
@inject IBasicWebScrapperSite webScrapperImplementation
<body>
    <div>
        <Header OnInputEvent="OnInputEvent" SearchPredefinedBook="SearchPredefinedBook" InputValue="@inputValue" AuthorName="@searchBook.Author.Name" Title="@searchBook.Title"></Header>
        <div>
        </div>
        <div>
            @if (isSearchDone)
            {
                <TableResult Link="searcherBooksCzytelnik.Links" Author="searcherBooksCzytelnik.Authors" BooksNames="searcherBooksCzytelnik.Books" PricePerBook="searcherBooksCzytelnik.Prices" Source="Czytelnik"></TableResult>
                <TableResult Link="searcherBooksPWN.Links" Author="searcherBooksPWN.Authors" BooksNames="searcherBooksPWN.Books" PricePerBook="searcherBooksPWN.Prices" Source="PWN"></TableResult>
                <TableResult Link="searcherBooksNiezwykle.Links" Author="searcherBooksNiezwykle.Authors" BooksNames="searcherBooksNiezwykle.Books" PricePerBook="searcherBooksNiezwykle.Prices" Source="WN"></TableResult>
            }
        </div>
    </div>
</body>
@code {
    ISearcherBooks searcherBooksCzytelnik;
    ISearcherBooks searcherBooksPWN;
    ISearcherBooks searcherBooksNiezwykle;
    //IFactorySearcher factorySearcher;
    TabConfigurator tabConfigurator = new TabConfigurator();
    ConstsBookScrapper consts = new ConstsBookScrapper();
    Book searchBook = new Book();
    List<Book> listOfBooks = new List<Book>();
    Query query = new Query();
    BookService bookService = new BookService();
    public string inputValue = "";
    bool isSearchDone = false;
    void SearchPredefinedBook()
    {
        searcherBooksCzytelnik = new CzytelnikSearcher(query, webScrapperImplementation);
        searcherBooksCzytelnik.BuildFullUrlToSearch(inputValue, searchBook.Author.Name, searchBook.Title, consts.CzytelnikSite);
        searchText(searcherBooksCzytelnik);
        searcherBooksPWN = new PWNSearcher(query, webScrapperImplementation);
        searcherBooksPWN.BuildFullUrlToSearch(inputValue, searchBook.Author.Name, searchBook.Title, consts.PWNSite);
        searchText(searcherBooksPWN);
        searcherBooksNiezwykle = new WydawnictwoNiezwykleSearcher(query, webScrapperImplementation);
        searcherBooksNiezwykle.BuildFullUrlToSearch(inputValue, searchBook.Author.Name, searchBook.Title, consts.NiezwykleSite);
        searchText(searcherBooksNiezwykle);
        isSearchDone = true;
    }
    protected override void OnInitialized()
    {
        tabConfigurator.TileColor = Color.Green.Name;
        listOfBooks.InitializeBooks();
    }
    private void OnInputEvent(ChangeEventArgs changeEvent)
    {
        inputValue = (string)changeEvent.Value;
    }
    void searchText(ISearcherBooks searcher)
    {
        searcher.SearchText(webScrapperImplementation.FullUrlToReadFrom,webScrapperImplementation,consts);
    }
}